function readSize(){var e=0,t=0;"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth,t=document.body.clientHeight),DIMS.width=e,DIMS.height=t}function easing(e,t,n,i,s,r){if(e==t)return 0;s=isNaN(s)?1:s;var o=(t-e)/n;return r&&(o=t>e?Math.ceil(o):Math.floor(o)),Math.abs(o)<s?Math.abs(e-t)>s?t>e?s:-s:t-e:t>e?Math.min(o,i):Math.max(o,-i)}function addEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function removeEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}function RESIZE_DIMS(e,t,n,i,s,r,o){var a=e,d=t,c=n,p=i,h=d,v=a;"VIEW_ALL"==s&&(h=p,v=a*p/d,v>c&&(h=d*c/a,v=c)),"FILL_ALL"==s&&(h=p,v=a*p/d,c>v&&(h=d*c/a,v=c)),0==o&&(v>a||h>d)&&(h=d,v=a),v=Math.round(v),h=Math.round(h);var E=-Math.round((v-c)/2),u=-Math.round((h-p)/2),l=r||"C";return"T"==l.slice(0,1)&&(u=0),"B"==l.slice(0,1)&&(u=p-h),("L"==l.slice(0,1)||"L"==l.slice(1,2))&&(E=0),("R"==l.slice(0,1)||"R"==l.slice(1,2))&&(E=c-v),{width:v,height:h,x:E,y:u}}function ADD_EVENT_DISPATCHER(e){Object.extend(e,Event_Dispatcher)}Object.extend=function(e,t){for(var n in t)e[n]=t[n];return e},Event={},Event.ERROR="error",Event.CANCEL="cancel",Event.OPEN="open",Event.CLOSE="close",Event.COMPLETE="onComplete",Event.CHANGE="onChange",Event.MOVE="MOVE",Event.START="START",Event.STOP="STOP",Event.RESIZE="resize",Event.SELECT="select",Event.RENDER="render",Event.REFRESH="refresh",Event.STATE_CHANGE="stateChange",Event.SOUND_COMPLETE="soundComplete",Event.FOCUS_OUT="focusOut",Event.FOCUS_IN="focusIn",Event.REMOVE="remove",Event.PROGRESS="progress",Event.UPLOAD="upload";var DIMS={};addEventSimple=addEvent,removeEventSimple=removeEvent;var Event_Dispatcher={};Event_Dispatcher.addEventListener=function(e,t,n){if(this.events||(this.events={}),this.events[e]||(this.events[e]=new Array),this.events[e].push({listener:t,scope:n}),this.events["promise."+e]){var i=this.events["promise."+e];t.constructor!=Function||n?"function"==(typeof t).toString()?(n.eventRecieverFunction=t,n.eventRecieverFunction({currentTarget:this,type:e,data:i})):n[t]({currentTarget:this,type:e,data:i}):t({currentTarget:this,type:e,data:i})}},Event_Dispatcher.dispatchEvent=function(e,t,n){if(this.events||(this.events={}),n&&(this.events["promise."+e]=t),this.events[e])for(var i=this.events[e],s=0;s<i.length;s++){var r=i[s].listener,o=i[s].scope;"function"==(typeof r).toString()?(o.eventRecieverFunction=r,o.eventRecieverFunction({currentTarget:this,type:e,data:t})):o[r]({currentTarget:this,type:e,data:t})}},Event_Dispatcher.removeEventListener=function(e,t,n){if(!this.events)return!1;if(!this.events[e])return!1;for(var i=this.events[e],s=0;s<i.length;s++)t==i[s].listener&&n==i[s].scope&&i.splice(s,1)},Event_Dispatcher._addEventListener=Event_Dispatcher.addEventListener,Event_Dispatcher._dispatchEvent=Event_Dispatcher.dispatchEvent,Event_Dispatcher._removeEventListener=Event_Dispatcher.removeEventListener,ImageUploader=function(e){this.fileInput=document.createElement("input"),this.fileInput.setAttribute("type","file"),this.fileInput.setAttribute("accept","image/*"),this.fileInput.setAttribute("onchange","this.dragUploader.processFiles(this.files)"),this.fileInput.dragUploader=this,document.body.appendChild(this.fileInput),this.fileInput.style.position="fixed",this.fileInput.style.top="-300px",this.upload=e&&e.upload,ADD_EVENT_DISPATCHER(this)},ImageUploader.prototype.browse=function(e){console.log(e),this.fileInput.click(e)},ImageUploader.prototype.imageReady=function(e,t){this.data=e,console.log("fileName",t),this.dispatchEvent(Event.COMPLETE,{fileName:t}),this.fileInput.setAttribute("onchange",""),this.fileInput.dragUploader=null,document.body.removeChild(this.fileInput),this.fileInput=document.createElement("input"),this.fileInput.setAttribute("type","file"),this.fileInput.setAttribute("onchange","this.dragUploader.processFiles(this.files)"),this.fileInput.dragUploader=this,document.body.appendChild(this.fileInput),this.fileInput.style.position="fixed",this.fileInput.style.top="-300px"},ImageUploader.prototype.onProgress=function(e){this.progress=e.loaded/e.total,this.dispatchEvent(Event.PROGRESS)},ImageUploader.prototype.startUpload=function(e){if(this.upload){var t=this,n=new FormData;n.append("file",e);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status)try{var e=JSON.parse(this.responseText);t.dispatchEvent(Event.UPLOAD,e)}catch(n){t.dispatchEvent(Event.UPLOAD)}},i.upload.addEventListener("progress",function(e){t.onProgress(e)},!1),i.open("POST",this.upload),i.send(n)}},ImageUploader.prototype.processFiles=function(e){var t=e[0];if(t){var n=t.name,i=n.split(/\./).pop().toLowerCase();if(("png"==i||"jpg"==i||"gif"==i||"jpeg"==i)&&"undefined"!=typeof FileReader){var s=this,r=new FileReader;r.onload=function(e){s.startUpload(t),s.imageReady(e.target.result,n)},r.readAsDataURL(t)}}};
function TimeLine(t,i){this.duration=t,this.direction=1,this._position=0,this.status="STOP",this.startTime=0,this.interval=i,this.intervalObj,this.data={},this.events={},ADD_EVENT_DISPATCHER(this);var n=this;this.REQ_ANIMATION=function(t){n.update()}}TimeLine.prototype.play=function(){if(1==this.direction&&this._position==this.duration||-1==this.direction&&0==this._position);else{if(this.startTime=(new Date).getTime()-this._position,"PLAY"!=this.status){var t=this,i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;if(i)i(this.REQ_ANIMATION);else{var t=this;this.intervalObj=setInterval(function(){t.update()},this.interval)}}this.status="PLAY"}},TimeLine.prototype.pause=function(){this.status="PAUSE",clearInterval(this.intervalObj)},TimeLine.prototype.stop=function(){this.status="STOP",clearInterval(this.intervalObj)},Object.defineProperty(TimeLine.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.startTime=(new Date).getTime()-this._position},configurable:!0}),TimeLine.prototype.update=function(){if(Date.now||(Date.now=function(){return(new Date).getTime()}),"PLAY"!=this.status)return!1;var t=Date.now();if(1==this.direction){if(this._position=t-this.startTime,this._position=Math.min(this.duration,this._position),this._position==this.duration)this.status="STOP",clearInterval(this.intervalObj),this.dispatchEvent(Event.COMPLETE),this.onComplete&&this.onComplete();else if("PLAY"==this.status){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;i&&i(this.REQ_ANIMATION)}}else if(this._position=Math.max(2*this._position-(t-this.startTime),0),this.startTime=t-this._position,0==this._position)this.status="STOP",clearInterval(this.intervalObj),this.dispatchEvent(Event.COMPLETE),this.onComplete&&this.onComplete();else if("PLAY"==this.status){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;i&&i(this.REQ_ANIMATION)}this.dispatchEvent(Event.CHANGE)},TimeLine.prototype.getTime=function(t,i,n){var e=Math.min(Math.max(this._position-t,0),i);return null!=n?n(e,0,1,i):this.easeInOut(e,0,1,i)},TimeLine.prototype.easeInOut=function(t,i,n,e){return-n/2*(Math.cos(Math.PI*t/e)-1)+i},TimeLine.prototype.easeInOutPos=function(t,i,n,e){return Math.acos(-(t-i)*(2/n)+1)*e/Math.PI},TimeLine.applyMatrix=function(t,i){if(t=t.constructor==Array?t:[t],!i){for(var n=0;n<t.length;n++){var e=t[n];e.style.transform="",e.style.MozTransform="",e.style.WebkitTransform="",e.style.msTransform="",e.style.OTransform=""}return!1}var o=i.hasOwnProperty("scale")?i.scale:1,a=i.hasOwnProperty("scaleX")?i.scaleX*o:o,s=i.hasOwnProperty("scaleY")?i.scaleY*o:o,r=(i.hasOwnProperty("rotation")?i.rotation:0)*(180/Math.PI),h=i.hasOwnProperty("x")?i.x:0,l=i.hasOwnProperty("y")?i.y:0,m=i.hasOwnProperty("opacity")?i.opacity:1;if(i.hasOwnProperty("radius")&&i.hasOwnProperty("angle")){var c=i.radius,p=i.angle;h=Math.round(c*Math.cos(p*Math.PI/180)*100)/100+h,l=Math.round(c*Math.sin(p*Math.PI/180)*100)/100+l}for(var u=[a*Math.cos(r),-Math.sin(r),Math.sin(r),s*Math.cos(r),h,l],d="matrix("+u.join(",")+")",n=0;n<t.length;n++){var y=!1,e=t[n];e.animation||(e.animation={}),e.animation.x!=h&&(e.animation.x=h,y=!0),e.animation.y!=l&&(e.animation.y=l,y=!0),e.animation.scaleX!=a&&(e.animation.scaleX=a,y=!0),e.animation.scaleY!=s&&(e.animation.scaleY=s,y=!0),e.animation.rotation!=i.rotation&&(e.animation.rotation=i.rotation,y=!0),i.hasOwnProperty("opacity")&&e.animation.opacity!=m&&(e.style.opacity=m,e.animation.opacity=m),y&&(e.style.transform=d,e.style.MozTransform=d,e.style.WebkitTransform=d,e.style.msTransform=d,e.style.OTransform=d)}};var Scroll={};Scroll.end,Scroll.timeLine=new TimeLine(500,33),Scroll.timeLine.addEventListener(Event.CHANGE,"refresh",Scroll),Scroll.go=function(t,i){Scroll.start=i||document.body.scrollTop||document.documentElement.scrollTop,Scroll.end=t,Scroll.timeLine.duration=Math.min(Math.max(200,1.5*Math.abs(Scroll.end-Scroll.start)),1500),Scroll.timeLine.position=0,Scroll.timeLine.play()},Scroll.refresh=function(){var t=Scroll.start+(Scroll.end-Scroll.start)*Scroll.timeLine.getTime(0,Scroll.timeLine.duration);document.body.scrollTop=t,document.documentElement.scrollTop=t};
function JSON_Loader(){this.request,this.url,this.isReady=!1,ADD_EVENT_DISPATCHER(this)}JSON_Loader.prototype.abort=function(){this.request&&this.request.abort()},JSON_Loader.prototype.send=function(e){this.load(e.url,e.data,e.contentType||null,e.requestMedthod||null,e.headers||null)},JSON_Loader.prototype.load=function(e,t,s,r,i){this.url=e,this.data=null,this.isReady=!1;var a=this;if(this.request&&this.request.abort(),window.XMLHttpRequest)this.request=new XMLHttpRequest,this.request.overrideMimeType&&this.request.overrideMimeType("text/xml");else if(window.ActiveXObject)try{this.request=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{this.request=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}if(!this.request)return alert("Giving up :( Cannot create an XMLHTTP instance"),!1;if(this.request.onreadystatechange=function(e){var t=!1,s=e.target,r=s.readyState;if(4==r)if(400==s.status)try{var i=unescape(escape(this.responseText).replace(/%0A/gim,"").replace(/%0D/gim,""));a.data=JSON.parse(i),a.dispatchEvent(Event.ERROR)}catch(n){console.log(n),a.dispatchEvent(Event.ERROR)}else if(200==s.status||"file:"===window.location.protocol&&0==s.status){try{var i=unescape(escape(this.responseText).replace(/%0A/gim,"").replace(/%0D/gim,""));a.data=JSON.parse(i)}catch(n){t=!0}t?(console.log("error:"+a.url+","+n),console.log("string:"+i),a.dispatchEvent(Event.CANCEL)):(a.isReady=!0,a.dispatchEvent(Event.COMPLETE))}},t){if(this.request.open(r||"POST",this.url,!0),s?this.request.setRequestHeader("Content-Type",s):this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i){console.log(i);for(var o=0;o<i.length;o++)console.log(i[o].name,i[o].value),this.request.setRequestHeader(i[o].name,i[o].value)}this.request.send(t)}else{if(this.request.open(r||"GET",this.url,!0),s&&this.request.setRequestHeader("Content-Type",s),i)for(var o=0;o<i.length;o++)this.request.setRequestHeader(i[o].name,i[o].value);this.request.send(null)}};
DragTouch=function(){this.startX=0,this.endY=0,ADD_EVENT_DISPATCHER(this);var t=this;this.__moveFN=function(i){t.moveFN(i),i.preventDefault()},this.__endFN=function(i){t.end(i),i.preventDefault()}},DragTouch.ZOOM="zoom",DragTouch.prototype.start=function(t){return this.startX=t.touches?t.touches[0].clientX:t.clientX,this.startY=t.touches?t.touches[0].clientY:t.clientY,this.moveX=0,this.moveY=0,this.endX=this.startX,this.endY=this.startY,this.zoom=null,this.dispatchEvent(Event.START),this.HTML_DIV=null,t.preventDefault(),"touchstart"==t.type?(addEventSimple(document,"touchmove",this.__moveFN),addEventSimple(document,"touchend",this.__endFN)):"mousedown"==t.type&&(addEventSimple(document,"mousemove",this.__moveFN),addEventSimple(document,"mouseup",this.__endFN)),!1},DragTouch.prototype.startDrag=function(t,i,e){return this.isActive?!1:(this.isActive=!0,this.hasMove=!1,this.start(t),e=e||{},i?(this.HTML_DIV=i,this.divX_Start=this.HTML_DIV.offsetLeft,this.divY_Start=this.HTML_DIV.offsetTop,this.position={x:this.divX_Start,y:this.divY_Start}):this.position={x:0,y:0},this.leftLimit=e.left!=e.undefined?e.left:null,this.topLimit=e.top!=e.undefined?e.top:null,this.rightLimit=e.right!=e.undefined?e.right:null,this.bottomLimit=e.bottom!=e.undefined?e.bottom:null,this.moveFree=null==this.leftLimit&&null==this.topLimit&&null==this.rightLimit&&null==this.bottomLimit,this.move={x:0,y:0},!0)},DragTouch.prototype.moveFN=function(t){if(t.touches){if(2==t.touches.length){var i;return this.zoom?i=Math.sqrt(Math.pow(t.touches[0].clientX-t.touches[1].clientX,2)+Math.pow(t.touches[0].clientY-t.touches[1].clientY,2)):(this.zoom=Math.sqrt(Math.pow(t.touches[0].clientX-t.touches[1].clientX,2)+Math.pow(t.touches[0].clientY-t.touches[1].clientY,2)),i=Math.sqrt(Math.pow(t.touches[0].clientX-t.touches[1].clientX,2)+Math.pow(t.touches[0].clientY-t.touches[1].clientY,2))),this.dispatchEvent(DragTouch.ZOOM,{zoom:i-this.zoom}),!1}t.touches.length>=2&&this.end(t)}if(!this.hasMove){var e=t.touches?t.touches[0].clientX:t.clientX,s=t.touches?t.touches[0].clientY:t.clientY;t.touches?(e-this.startX)*(e-this.startX)+(s-this.startY)*(s-this.startY)>100&&(this.startX=e,this.startY=s,this.moveX=0,this.moveY=0,this.endX=this.startX,this.endY=this.startY,this.hasMove=!0):(e!=this.startX||s!=this.startY)&&(this.hasMove=!0)}if(!this.hasMove)return!1;if(this.endX=t.touches?t.touches[0].clientX:t.clientX,this.endY=t.touches?t.touches[0].clientY:t.clientY,this.moveX=this.endX-this.startX,this.moveY=this.endY-this.startY,this.HTML_DIV){var h=this.divX_Start+this.moveX,o=this.divY_Start+this.moveY;1!=this.moveFree?(null!=this.rightLimit&&null!=this.leftLimit&&(h=Math.min(h,this.rightLimit),h=Math.max(h,this.leftLimit),this.HTML_DIV.style.left=h+"px"),null!=this.bottomLimit&&null!=this.topLimit&&(o=Math.min(o,this.bottomLimit),o=Math.max(o,this.topLimit),this.HTML_DIV.style.top=o+"px")):(this.HTML_DIV.style.left=h+"px",this.HTML_DIV.style.top=o+"px"),this.position={x:h,y:o},this.move={x:h-this.divX_Start,y:o-this.divY_Start}}else this.move={x:this.moveX,y:this.moveY},null!=this.rightLimit&&null!=this.leftLimit&&(this.move.x=Math.min(this.move.x,this.rightLimit),this.move.x=Math.max(this.move.x,this.leftLimit)),null!=this.bottomLimit&&null!=this.topLimit&&(this.move.y=Math.min(this.move.y,this.bottomLimit),this.move.y=Math.max(this.move.y,this.topLimit)),this.position=this.move;this.dispatchEvent(Event.MOVE,{clientX:this.endX,clientY:this.endY,move:this.move,position:this.position})},DragTouch.prototype.end=function(t){this.isActive=!1,"touchend"==t.type?(removeEventSimple(document,"touchmove",this.__moveFN),removeEventSimple(document,"touchend",this.__endFN)):"mouseup"==t.type&&(removeEventSimple(document,"mousemove",this.__moveFN),removeEventSimple(document,"mouseup",this.__endFN));var i=t.touches?t.touches.length>0?t.touches[0].clientX:this.endX:t.clientX,e=t.touches?t.touches.length>0?t.touches[0].clientY:this.endY:t.clientY;t={clientX:i,clientY:e,move:this.move,position:this.positionY},this.dispatchEvent(Event.STOP,t),document.getElementsByTagName("body")[0].style.userSelect="",document.getElementsByTagName("body")[0].style.webkitUserSelect="",document.getElementsByTagName("body")[0].style.MozUserSelect="",document.getElementsByTagName("body")[0].setAttribute("unselectable","off")};