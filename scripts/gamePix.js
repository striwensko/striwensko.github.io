(function(){
    Object.extend=function(e,t){for(var n in t)e[n]=t[n];return e},Object.merge=function(e,t){for(var n in t)null===t[n]?e[n]=null:e[n]&&e[n].constructor==Object&&t[n].constructor==Object?Object.merge(e[n],t[n]):e[n]=t[n];return e},Event={},Event.ERROR="error",Event.CANCEL="cancel",Event.OPEN="open",Event.CLOSE="close",Event.COMPLETE="onComplete",Event.CHANGE="onChange",Event.MOVE="MOVE",Event.START="START",Event.STOP="STOP",Event.RESIZE="resize",Event.SELECT="select",Event.RENDER="render",Event.REFRESH="refresh",Event.STATE_CHANGE="stateChange",Event.SOUND_COMPLETE="soundComplete",Event.FOCUS_OUT="focusOut",Event.FOCUS_IN="focusIn",Event.ADD="add",Event.REMOVE="remove",Event.PROGRESS="progress",Event.UPLOAD="upload",Event.REMOVE="remove",Event.DELETE="delete";var DIMS={};function readSize(){var e=0,t=0;"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth,t=document.body.clientHeight),DIMS.width=e,DIMS.height=t}function easing(e,t,n,i,o,r){if(e==t)return 0;o=isNaN(o)?1:o;var s=(t-e)/n;return r&&(s=e<t?Math.ceil(s):Math.floor(s)),Math.abs(s)<o?Math.abs(e-t)>o?t>e?o:-o:t-e:e<t?Math.min(s,i):Math.max(s,-i)}function addEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function removeEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}function RESIZE_DIMS(e,t,n,i,o,r,s){var a=n,l=i,d=t,p=e;"VIEW_ALL"==o&&(d=l,(p=e*l/t)>a&&(d=t*a/e,p=a)),"FILL_ALL"==o&&(d=l,(p=e*l/t)<a&&(d=t*a/e,p=a)),0==s&&(p>e||d>t)&&(d=t,p=e),p=Math.round(p),d=Math.round(d);var h=-Math.round((p-a)/2),u=-Math.round((d-l)/2),c=r||"C";return"T"==c.slice(0,1)&&(u=0),"B"==c.slice(0,1)&&(u=l-d),"L"!=c.slice(0,1)&&"L"!=c.slice(1,2)||(h=0),"R"!=c.slice(0,1)&&"R"!=c.slice(1,2)||(h=a-p),{width:p,height:d,x:h,y:u}}addEventSimple=addEvent,removeEventSimple=removeEvent;var Event_Dispatcher={};function ADD_EVENT_DISPATCHER(e){Object.extend(e,Event_Dispatcher)}Event_Dispatcher.all=function(e){};var StateManager={};function ADD_STATE_MANAGER(e){Object.extend(e,StateManager),e.state||(e.state={}),e.requestStateUpdate=function(t){e.__stateManager.onState()}}StateManager.setState=function(e,t){var n=this;if(this.state||(this.state={}),this.__stateManager||(this.__stateManager={pending:[],onState:function(){for(var e=n.__stateManager.pending,t=[],i={};e.length>0;){var o=e.shift();t.push(o),i=Object.merge(i,o.data)}n.state=Object.merge({},n.state),n.state=Object.merge(n.state,i),n.__stateManager.requestUpdate=!1,i.findAction=function(e){for(var n=[],i=0;i<t.length;i++)t[i].data.hasOwnProperty(e)&&t[i].action&&n.push(t[i].action);return n},n.onState&&n.onState(i)}}),this.__stateManager.pending.push({data:e,action:t}),this.__stateManager.requestUpdate)return!0;this.__stateManager.requestUpdate=!0;var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;if(i)i(this.requestStateUpdate);else{n=this;setTimeout(function(){n.requestStateUpdate()},33)}},Event_Dispatcher.addEventListener=function(e,t,n){this.events||(this.events={}),this.events[e]||(this.events[e]=new Array),this.events[e].push({listener:t,scope:n})},Event_Dispatcher.dispatchEvent=function(e,t){if(this.events||(this.events={}),this.events[e])for(var n=this.events[e],i=0;i<n.length;i++){var o=n[i].listener,r=n[i].scope;"function"==(typeof o).toString()?r?(r.eventRecieverFunction=o,r.eventRecieverFunction({currentTarget:this,type:e,data:t})):o({currentTarget:this,type:e,data:t}):r[o]({currentTarget:this,type:e,data:t})}},Event_Dispatcher.removeEventListener=function(e,t,n){if(!this.events)return!1;if(!this.events[e])return!1;for(var i=this.events[e],o=0;o<i.length;o++)t==i[o].listener&&n==i[o].scope&&i.splice(o,1)},Event_Dispatcher._addEventListener=Event_Dispatcher.addEventListener,Event_Dispatcher._dispatchEvent=Event_Dispatcher.dispatchEvent,Event_Dispatcher._removeEventListener=Event_Dispatcher.removeEventListener,Browser={},Browser.nodeParse=function(e,t){for(var n=e.children,i=0;i<n.length;i++){if(n[i].getAttribute("var"))for(var o=n[i].getAttribute("var").split("."),r=t;o.length>0;){var s=o.shift();0==o.length?r[s]=n[i]:(r.hasOwnProperty(s)||(r[s]={}),r=r[s])}Browser.nodeParse(n[i],t)}},Browser.DOM=function(e,t){var n;e.constructor===String?(n=document.createElement("div")).innerHTML=e:n=e;var i=t||{};if(function e(t,n){for(var i=t.children,o=0;o<i.length;o++){if(i[o].getAttribute("var"))for(var r=i[o].getAttribute("var").split("."),s=n;r.length>0;){var a=r.shift();0==r.length?s[a]=i[o]:(s.hasOwnProperty(a)||(s[a]={}),s=s[a])}e(i[o],n)}}(n,i),e.constructor!=String)return!1;if(1==n.childNodes.length)return t||(n.childNodes[0].nodes=i),n.childNodes[0];for(var o=document.createDocumentFragment(),r=n.childNodes;r.length>0;)o.append(r[0]);return o.nodes=i,o},Browser.urlParams=function(e){var t={},n=e||window.location.href;if(1==n.split("?").length&&1==n.split("#").length)return t;if(n.split("?").length>1)for(var i=n.split("?").pop().split("&"),o=0;o<i.length;o++){t[(r=i[o].split("="))[0]]=r[1]}if(n.split("#").length>1)for(i=n.split("#").pop().split("&"),o=0;o<i.length;o++){var r;t[(r=i[o].split("="))[0]]=r[1]}return t},Browser.urlUpdate=function(e){var t=window.location.href,n={};if("2"==t.split("?").length)for(var i=t.split("?").pop().split("&"),o=0;o<i.length;o++){var r=i[o].split("=");n[r[0]]=r[1]}for(var s in e)n[s]=e[s];var a=t.split("?")[0]+"?";i="";for(var s in n)i+=(""==i?"":"&")+s+"="+n[s];return a+i},Browser.Router={},Browser.Router.url=null,Browser.Router.routes=[],Browser.Router.optionalParam=/\((.*?)\)/gim,Browser.Router.namedParam=/(\(\?)?:\w+;/gim,Browser.Router.splatParam=/\*\w+/gim,Browser.Router.escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/gim,ADD_EVENT_DISPATCHER(Browser.Router),Browser.Router.start=function(){var e=this;window.onpopstate=function(){e.onRoute()},this.onRoute()},Browser.Router.onRoute=function(){var e=document.location.toString();if(this.url!=e){var t=e.split("#");t=t.length>1?t.pop():"",this.url=e,this.detectRoute(t)}},Browser.Router.supportSlashHistory=function(){return!(!window.history||void 0===window.history.pushState)},Browser.Router.navigate=function(e,t,n){if(this.supportSlashHistory()){var i=window.location.toString().split("#")[0];e.split("=").length,i=i+"#"+e,this.url!=i&&(this.url=i,0==n?window.history.replaceState(t,"",i):window.history.pushState(t,"",i)),this.detectRoute(e)}},Browser.Router.detectRoute=function(e){for(var t=0;t<this.routes.length;t++){if(e.match(this.routes[t].regExp)){var n=this.routes[t].regExp.exec(e).slice(1),i=this.routes[t].paramNames,o={};if(i)for(var r=0;r<i.length;r++){var s=i[r].split(":");2==s.length?(o[s[0]]||(o[s[0]]={}),o[s[0]][s[1]]=n[r]):o[i[r]]=n[r]}this.dispatchEvent(Event.CHANGE,{path:e,data:this.routes[t].data,params:o});break}}},Browser.Router.addRoute=function(e,t){var n={};n.path=e,n.data=t;var i=(e=(e=e.replace(/\:/gim,"___")).replace(/\{/gim,":").replace(/\}/gim,";")).match(Browser.Router.namedParam);if(n.paramNames=i,i)for(var o=0;o<i.length;o++)i[o]=i[o].replace(":","").replace(";",""),i[o]=i[o].replace("___",":");n.regExp=this.translatePathToRegExp(e),e.split("{").length>1?this.routes.push(n):this.routes.unshift(n)},Browser.Router.translatePathToRegExp=function(e){return e=(e=(e=(e=e.replace(Browser.Router.escapeRegExp,"\\$&")).replace(Browser.Router.optionalParam,"(?:$1)?")).replace(Browser.Router.namedParam,function(e,t){return t?e:"([^/]+)"})).replace(Browser.Router.splatParam,"(.*?)"),new RegExp("^"+e+"$")},Browser.getSize=function(){var e=0,t=0;return"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth,t=document.body.clientHeight),Browser.width=e,Browser.height=t,{width:e,height:t}},Browser.Message=function(){this.holder=document.createElement("div"),this.holder.className="messageSystem",this.items={},document.body.appendChild(this.holder),this.timeLine=new TimeLine(1/0,33),this.timeLine.addEventListener(Event.CHANGE,"update",this),this.timeLine.play()},Browser.Message.prototype.update=function(e){for(var t in this.items){var n=this.items[t];n&&(n.style.opacity=1*this.timeLine.getTime(n.startTime,300),n.style.marginBottom=35*(1-this.timeLine.getTime(n.startTime,300))+"px",n.endTime&&this.timeLine.position>n.endTime&&(n.style.opacity=1-this.timeLine.getTime(n.endTime,300),this.timeLine.position>n.endTime+300&&(n.parentNode.removeChild(n),this.items[n.id]=null)))}},Browser.Message.prototype.hide=function(e,t){this.items[e]&&(this.items[e].endTime=this.timeLine.position+(1==t?-300:0)),this.update()},Browser.Message.prototype.show=function(e,t,n){n=n||"msg_"+(new Date).getTime()+"_"+Math.floor(1e3*Math.random());var i,o=this.items;return this.items[n]?i=this.items[n]:((i=document.createElement("div")).id=n,i.style.opacity=.5,i.startTime=this.timeLine.position,this.holder.children.length>0?this.holder.insertBefore(i,this.holder.children[0]):this.holder.appendChild(i),o[n]=i),i.innerHTML=e,i.endTime=t?this.timeLine.position+t:null,n},Browser.Message.show=function(e,t,n){this.instance||(this.instance=new Browser.Message),this.instance.show(e,t,n)},Browser.UI={},Browser.UI.collapse=function(e,t,n,i){var o=0;e.collapse={};var r=new TimeLine(500,33);r.position=n?500:0,r.direction=n?1:-1,r.addEventListener(Event.CHANGE,"render",r),r.render=function(){t.style.height=o*this.getTime(0,500)+"px",t.style.display=0==this.position?"none":"",t.style.overflow=this.position==this.duration?"":"hidden"},e.collapse.toggle=function(n){r.direction=1==r.direction?-1:1;var s=t.style.overflow,a=t.style.display;t.style.height="",t.style.display="block",t.style.overflow="visible",o=t.offsetHeight,console.log(o),t.style.display=a,t.style.overflow=s,r.play(),i&&((i.toggleButton||e).className=1==r.direction?i.open:i.close)},e.onclick=e.collapse.toggle},Browser.UI.popupize=function(e,t,n){e.popup={},e.popup.mouseDownFN=function(i){for(var o=i.target;o;){if(o==e||o==t)return!0;o=o.parentNode}t.style.display="none",n&&e.classList.remove(n),removeEventSimple(document,"mousedown",e.popup.mouseDownFN)},e.popup.close=function(){t.style.display="none",n&&e.classList.remove(n),removeEventSimple(document,"mousedown",e.popup.mouseDownFN)},e.popup.toggle=function(i){for(var o=i.target;o;){if(o==t)return!0;o=o.parentNode}t.style.display="none"==t.style.display?"":"none",""==t.style.display?(n&&!e.classList.contains(n)&&n&&e.classList.add(n),addEventSimple(document,"mousedown",e.popup.mouseDownFN)):(n&&e.classList.remove(n),removeEventSimple(document,"mousedown",e.popup.mouseDownFN))},e.onclick=e.popup.toggle},Browser.UI.reorder=function(e,t,n){var i=e.parentNode,o=e.parentNode.children,r=o[o.length-1].getBoundingClientRect().bottom-e.parentNode.getBoundingClientRect().top-e.getBoundingClientRect().height,s=e.cloneNode(!0);s.style.position="absolute",s.style.opacity=.7,s.style.backgroundColor="#fff",s.style.top=e.getBoundingClientRect().top-e.parentNode.getBoundingClientRect().top+"px",e.parentNode.appendChild(s);var a=new DragTouch,l=!1;a.addEventListener(Event.MOVE,function(){l=!0,"none"==s.style.display&&(s.style.display=""),e.style.opacity=0;for(var t=s.offsetTop+i.getBoundingClientRect().top,n=s.offsetTop+s.offsetHeight+i.getBoundingClientRect().top,o=i.children,r=0;r<o.length;r++){var a=o[r],d=a.getBoundingClientRect();if(a==s)break;if(t<=d.top+d.height/2&&t>=d.top&&a!=e)return i.insertBefore(e,a),!0;if(n<=d.top+d.height&&n>=d.top+d.height/2&&a!=e)return i.insertBefore(a,e),!0}}),a.addEventListener(Event.STOP,function(){e.style.opacity="",e.parentNode.removeChild(s),l&&n(e)}),a.startDrag(t,s,{top:0,bottom:r}),s.style.display="none"},ImageUploader=function(e){this.fileInput=document.createElement("input"),this.fileInput.setAttribute("type","file"),this.fileInput.setAttribute("accept","image/*"),this.fileInput.setAttribute("onchange","this.dragUploader.processFiles(this.files)"),this.fileInput.dragUploader=this,document.body.appendChild(this.fileInput),this.fileInput.style.position="fixed",this.fileInput.style.top="-300px",this.upload=e&&e.upload,ADD_EVENT_DISPATCHER(this)},ImageUploader.prototype.browse=function(e){console.log(e),this.fileInput.setAttribute("multiple","multiple"),this.fileInput.click(e)},ImageUploader.prototype.imageReady=function(e,t){this.data=e,console.log("fileName",t),this.dispatchEvent(Event.COMPLETE,{fileName:t}),this.fileInput.setAttribute("onchange",""),this.fileInput.dragUploader=null,document.body.removeChild(this.fileInput),this.fileInput=document.createElement("input"),this.fileInput.setAttribute("type","file"),this.fileInput.setAttribute("onchange","this.dragUploader.processFiles(this.files)"),this.fileInput.dragUploader=this,document.body.appendChild(this.fileInput),this.fileInput.style.position="fixed",this.fileInput.style.top="-300px"},ImageUploader.prototype.onProgress=function(e){this.progress=e.loaded/e.total,this.dispatchEvent(Event.PROGRESS)},ImageUploader.prototype.startUpload=function(e){if(this.upload){var t=this,n=new FormData;n.append("file",e);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status)try{var e=JSON.parse(this.responseText);t.dispatchEvent(Event.UPLOAD,e)}catch(e){t.dispatchEvent(Event.UPLOAD)}},i.upload.addEventListener("progress",function(e){t.onProgress(e)},!1),i.open("POST",this.upload),i.send(n)}},ImageUploader.prototype.processFiles=function(e,t){var n=e[t=t||0];if(n){var i=n.name,o=(i.split(/\./).pop().toLowerCase(),this),r=new FileReader;r.onload=function(r){o.startUpload(n),o.imageReady(r.target.result,i),++t<e.length&&o.processFiles(e,t)},r.readAsDataURL(n)}};
    function TimeLine(t,i){this.duration=t,this.direction=1,this._position=0,this.status="STOP",this.startTime=0,this.interval=i,this.intervalObj,this.data={},this.events={},ADD_EVENT_DISPATCHER(this);var e=this;this.REQ_ANIMATION=function(t){e.update()}}TimeLine.prototype.play=function(){if(1==this.direction&&this._position==this.duration||-1==this.direction&&0==this._position);else{if(this.startTime=(new Date).getTime()-this._position,"PLAY"!=this.status){var t=this,i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;if(i)i(this.REQ_ANIMATION);else{t=this;this.intervalObj=setInterval(function(){t.update()},this.interval)}}this.status="PLAY"}},TimeLine.prototype.pause=function(){this.status="PAUSE",clearInterval(this.intervalObj)},TimeLine.prototype.stop=function(){this.status="STOP",clearInterval(this.intervalObj)},Object.defineProperty(TimeLine.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.startTime=(new Date).getTime()-this._position},configurable:!0}),TimeLine.prototype.update=function(){if(Date.now||(Date.now=function(){return(new Date).getTime()}),"PLAY"!=this.status)return!1;var t=Date.now();if(1==this.direction)this._position=t-this.startTime,this._position=Math.min(this.duration,this._position),this._position==this.duration?(this.status="STOP",clearInterval(this.intervalObj),this.dispatchEvent(Event.COMPLETE),this.onComplete&&this.onComplete()):"PLAY"==this.status&&(i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)&&i(this.REQ_ANIMATION);else if(this._position=Math.max(2*this._position-(t-this.startTime),0),this.startTime=t-this._position,0==this._position)this.status="STOP",clearInterval(this.intervalObj),this.dispatchEvent(Event.COMPLETE),this.onComplete&&this.onComplete();else if("PLAY"==this.status){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;i&&i(this.REQ_ANIMATION)}this.dispatchEvent(Event.CHANGE)},TimeLine.prototype.getTime=function(t,i,e){var n=Math.min(Math.max(this._position-t,0),i);return null!=e?e(n,0,1,i):this.easeInOut(n,0,1,i)},TimeLine.prototype.easeInOut=function(t,i,e,n){return-e/2*(Math.cos(Math.PI*t/n)-1)+i},TimeLine.prototype.easeInOutPos=function(t,i,e,n){return Math.acos(2/e*-(t-i)+1)*n/Math.PI},TimeLine.applyMatrix=function(t,i){if(t=t.constructor==Array?t:[t],!i){for(p=0;p<t.length;p++)(d=t[p]).style.transform="",d.style.MozTransform="",d.style.WebkitTransform="",d.style.msTransform="",d.style.OTransform="";return!1}var e=i.hasOwnProperty("scale")?i.scale:1,n=i.hasOwnProperty("scaleX")?i.scaleX*e:e,o=i.hasOwnProperty("scaleY")?i.scaleY*e:e,s=(i.hasOwnProperty("rotation")?i.rotation:0)*(Math.PI/180),a=i.hasOwnProperty("x")?i.x:0,r=i.hasOwnProperty("y")?i.y:0,l=i.hasOwnProperty("opacity")?i.opacity:1;if(i.hasOwnProperty("radius")&&i.hasOwnProperty("angle")){var h=i.radius,m=i.angle;a=Math.round(h*Math.cos(m*Math.PI/180)*100)/100+a,r=Math.round(h*Math.sin(m*Math.PI/180)*100)/100+r}for(var c="matrix("+[n*Math.cos(s),-o*Math.sin(s),o*Math.sin(s),o*Math.cos(s),a,r].join(",")+")",p=0;p<t.length;p++){var u=!1,d=t[p];d.animation||(d.animation={}),d.animation.x!=a&&(d.animation.x=a,u=!0),d.animation.y!=r&&(d.animation.y=r,u=!0),d.animation.scaleX!=n&&(d.animation.scaleX=n,u=!0),d.animation.scaleY!=o&&(d.animation.scaleY=o,u=!0),d.animation.rotation!=i.rotation&&(d.animation.rotation=i.rotation,u=!0),i.hasOwnProperty("opacity")&&d.animation.opacity!=l&&(d.style.opacity=l,d.animation.opacity=l),u&&(d.style.transform=c,d.style.MozTransform=c,d.style.WebkitTransform=c,d.style.msTransform=c,d.style.OTransform=c)}};var Scroll={};Scroll.end,Scroll.timeLine=new TimeLine(500,33),Scroll.timeLine.addEventListener(Event.CHANGE,"refresh",Scroll),Scroll.go=function(t,i,e){Scroll.element=i,Scroll.start=Scroll.element?i.scrollTop:e||document.body.scrollTop||document.documentElement.scrollTop,t.nodeType&&(t=t.getBoundingClientRect().top+Scroll.start),Scroll.end=t,console.log(Scroll.start,Scroll.end),Scroll.timeLine.duration=Math.min(Math.max(200,1.5*Math.abs(Scroll.end-Scroll.start)),1500),Scroll.timeLine.position=0,Scroll.timeLine.play()},Scroll.refresh=function(){var t=Scroll.start+(Scroll.end-Scroll.start)*Scroll.timeLine.getTime(0,Scroll.timeLine.duration);Scroll.element?Scroll.element.scrollTop=t:(document.body.scrollTop=t,document.documentElement.scrollTop=t)};
    function JSON_Loader(){this.request,this.url,this.isReady=!1,ADD_EVENT_DISPATCHER(this)}JSON_Loader.prototype.abort=function(){this.request&&this.request.abort()},JSON_Loader.prototype.send=function(e){this.load(e.url,e.data,e.contentType||null,e.requestMethod||null,e.headers||null)},JSON_Loader.prototype.load=function(e,t,s,r,i){this.url=e,this.data=null,this.isReady=!1;var a=this;if(this.request&&this.request.abort(),window.XMLHttpRequest)this.request=new XMLHttpRequest,this.request.overrideMimeType&&this.request.overrideMimeType("text/xml");else if(window.ActiveXObject)try{this.request=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{this.request=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(!this.request)return alert("Giving up :( Cannot create an XMLHTTP instance"),!1;if(this.request.onreadystatechange=function(e){var t=!1,s=e.target;if(4==s.readyState)if(400==s.status)try{r=unescape(escape(this.responseText).replace(/%0A/gim,"").replace(/%0D/gim,""));a.data=JSON.parse(r),a.dispatchEvent(Event.ERROR)}catch(e){console.log(e),a.dispatchEvent(Event.ERROR)}else if(200==s.status||"file:"===window.location.protocol&&0==s.status){try{var r=unescape(escape(this.responseText).replace(/%0A/gim,"").replace(/%0D/gim,""));a.data=JSON.parse(r)}catch(e){t=!0}t?(console.log("error:"+a.url+","+t),console.log("string:"+r),a.dispatchEvent(Event.CANCEL)):(a.isReady=!0,a.dispatchEvent(Event.COMPLETE))}},t){if(this.request.open(r||"POST",this.url,!0),s?this.request.setRequestHeader("Content-Type",s):this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i)for(n=0;n<i.length;n++)console.log(i[n].name,i[n].value),this.request.setRequestHeader(i[n].name,i[n].value);this.request.send(t)}else{if(this.request.open(r||"GET",this.url,!0),s&&this.request.setRequestHeader("Content-Type",s),i)for(var n=0;n<i.length;n++)this.request.setRequestHeader(i[n].name,i[n].value);this.request.send(null)}};
    DragTouch=function(){this.startX=0,this.endY=0,ADD_EVENT_DISPATCHER(this);var t=this;this.__moveFN=function(i){t.moveFN(i),i.preventDefault()},this.__endFN=function(i){t.end(i),i.preventDefault()}},DragTouch.ZOOM="zoom",DragTouch.prototype.start=function(t){return this.startX=t.touches?t.touches[0].clientX:t.clientX,this.startY=t.touches?t.touches[0].clientY:t.clientY,this.moveX=0,this.moveY=0,this.endX=this.startX,this.endY=this.startY,this.zoom=null,this.dispatchEvent(Event.START),this.HTML_DIV=null,t.preventDefault(),"touchstart"==t.type?(addEventSimple(document,"touchmove",this.__moveFN),addEventSimple(document,"touchend",this.__endFN)):"mousedown"==t.type&&(addEventSimple(document,"mousemove",this.__moveFN),addEventSimple(document,"mouseup",this.__endFN)),!1},DragTouch.prototype.startDrag=function(t,i,e){return this.isActive?!1:(this.isActive=!0,this.hasMove=!1,this.start(t),e=e||{},i?(this.HTML_DIV=i,this.divX_Start=this.HTML_DIV.offsetLeft,this.divY_Start=this.HTML_DIV.offsetTop,this.position={x:this.divX_Start,y:this.divY_Start}):this.position={x:0,y:0},this.leftLimit=e.left!=e.undefined?e.left:null,this.topLimit=e.top!=e.undefined?e.top:null,this.rightLimit=e.right!=e.undefined?e.right:null,this.bottomLimit=e.bottom!=e.undefined?e.bottom:null,this.moveFree=null==this.leftLimit&&null==this.topLimit&&null==this.rightLimit&&null==this.bottomLimit,this.move={x:0,y:0},!0)},DragTouch.prototype.moveFN=function(t){if(t.touches){if(2==t.touches.length){var i;return this.zoom?i=Math.sqrt(Math.pow(t.touches[0].clientX-t.touches[1].clientX,2)+Math.pow(t.touches[0].clientY-t.touches[1].clientY,2)):(this.zoom=Math.sqrt(Math.pow(t.touches[0].clientX-t.touches[1].clientX,2)+Math.pow(t.touches[0].clientY-t.touches[1].clientY,2)),i=Math.sqrt(Math.pow(t.touches[0].clientX-t.touches[1].clientX,2)+Math.pow(t.touches[0].clientY-t.touches[1].clientY,2))),this.dispatchEvent(DragTouch.ZOOM,{zoom:i-this.zoom}),!1}t.touches.length>=2&&this.end(t)}if(!this.hasMove){var e=t.touches?t.touches[0].clientX:t.clientX,s=t.touches?t.touches[0].clientY:t.clientY;t.touches?(e-this.startX)*(e-this.startX)+(s-this.startY)*(s-this.startY)>100&&(this.startX=e,this.startY=s,this.moveX=0,this.moveY=0,this.endX=this.startX,this.endY=this.startY,this.hasMove=!0):(e!=this.startX||s!=this.startY)&&(this.hasMove=!0)}if(!this.hasMove)return!1;if(this.endX=t.touches?t.touches[0].clientX:t.clientX,this.endY=t.touches?t.touches[0].clientY:t.clientY,this.moveX=this.endX-this.startX,this.moveY=this.endY-this.startY,this.HTML_DIV){var h=this.divX_Start+this.moveX,o=this.divY_Start+this.moveY;1!=this.moveFree?(null!=this.rightLimit&&null!=this.leftLimit&&(h=Math.min(h,this.rightLimit),h=Math.max(h,this.leftLimit),this.HTML_DIV.style.left=h+"px"),null!=this.bottomLimit&&null!=this.topLimit&&(o=Math.min(o,this.bottomLimit),o=Math.max(o,this.topLimit),this.HTML_DIV.style.top=o+"px")):(this.HTML_DIV.style.left=h+"px",this.HTML_DIV.style.top=o+"px"),this.position={x:h,y:o},this.move={x:h-this.divX_Start,y:o-this.divY_Start}}else this.move={x:this.moveX,y:this.moveY},null!=this.rightLimit&&null!=this.leftLimit&&(this.move.x=Math.min(this.move.x,this.rightLimit),this.move.x=Math.max(this.move.x,this.leftLimit)),null!=this.bottomLimit&&null!=this.topLimit&&(this.move.y=Math.min(this.move.y,this.bottomLimit),this.move.y=Math.max(this.move.y,this.topLimit)),this.position=this.move;this.dispatchEvent(Event.MOVE,{clientX:this.endX,clientY:this.endY,move:this.move,position:this.position})},DragTouch.prototype.end=function(t){this.isActive=!1,"touchend"==t.type?(removeEventSimple(document,"touchmove",this.__moveFN),removeEventSimple(document,"touchend",this.__endFN)):"mouseup"==t.type&&(removeEventSimple(document,"mousemove",this.__moveFN),removeEventSimple(document,"mouseup",this.__endFN));var i=t.touches?t.touches.length>0?t.touches[0].clientX:this.endX:t.clientX,e=t.touches?t.touches.length>0?t.touches[0].clientY:this.endY:t.clientY;t={clientX:i,clientY:e,move:this.move,position:this.positionY},this.dispatchEvent(Event.STOP,t),document.getElementsByTagName("body")[0].style.userSelect="",document.getElementsByTagName("body")[0].style.webkitUserSelect="",document.getElementsByTagName("body")[0].style.MozUserSelect="",document.getElementsByTagName("body")[0].setAttribute("unselectable","off")};
    var Require=function(e,i,t,r){Require.addItem(e,i,t,r)};Require.length=0,Require.dictionary={},Require.queue=[],Require.loading=[],Require.loaded=0,Require.SIZE=3,Require.onReady=function(){},Require.images={},Require.start=function(){Require.loader||(Require.loader=document.createElement("div"),Require.loader.className="app-loader",Require.loader.barHolder=document.createElement("div"),Require.loader.barHolder.className="bar-holder",Require.loader.appendChild(Require.loader.barHolder),Require.loader.bar=document.createElement("div"),Require.loader.bar.className="bar",Require.loader.barHolder.appendChild(Require.loader.bar)),Require.next()},Require.updateLoader=function(){var e=Require.loaded/Require.length;Require.loader.bar.style.width=100*e+"%"},Require.next=function(){for(var e=0;e<this.queue.length;e++){for(var i=this.queue[e].items,t=i.length-1;t>=0;t--)if(!this.isLoading(i[t])&&!this.hasBranches(i[t]))return this.load(i[t]),this.loading.length<Require.SIZE&&this.next(),!0;if(0==i.length&&!this.isLoading(this.queue[e].url))return this.load(this.queue[e].url),this.loading.length<Require.SIZE&&this.next(),!0}return!1},Require.hasBranches=function(e){for(var i=0;i<this.queue.length;i++)if(this.queue[i].url==e)return!0;return!1},Require.isLoading=function(e){for(var i=0;i<this.loading.length;i++)if(this.loading[i]==e)return!0;return!1},Require.load=function(e){e.split(".png").length>1||e.split(".jpg").length>1||e.split(".jpeg").length>1||e.split(".gif").length>1||e.split(".svg").length>1?this.loadImage(e):e.split(".js").length>1?this.loadJs(e):e.split(".css").length>1&&this.loadCss(e)},Require.loadImage=function(e){console.log("image",e);var i=e;i.split("?").length>1?i+="&time="+(new Date).getTime():i+="?time="+(new Date).getTime();var t=new Image;t.src=i,t.onload=function(){console.log("load",e),Require.onload(this,e)},t.onerror=function(){Require.onload(this,e)},Require.images[e]=t,Require.loading.push(e)},Require.getImage=function(e){return Require.images[e]},Require.loadJs=function(e){var i=e;i.split("?").length>1?i+="&time="+(new Date).getTime():i+="?time="+(new Date).getTime();var t=document.createElement("script");t.setAttribute("src",i),t.setAttribute("type","text/javascript"),t.onload=function(){Require.onload(this,e)},t.onerror=function(){Require.onload(this,e)},document.head.appendChild(t),Require.loading.push(e)},Require.loadCss=function(e){var i=e;i.split("?").length>1?i+="&time="+(new Date).getTime():i+="?time="+(new Date).getTime();var t=document.createElement("link");t.setAttribute("href",i),t.setAttribute("rel","stylesheet"),t.onload=function(){Require.onload(this,e)},t.onerror=function(){Require.onload(this,e)},document.head.appendChild(t),Require.loading.push(e)},Require.onload=function(e,i){this.dictionary[i].load=!0;for(var t=this.loading.length-1;t>=0;t--)this.loading[t]==i&&this.loading.splice(t,1);for(var r=this.queue.length-1;r>=0;r--)if(this.queue[r].url==i)this.queue[r].fn&&this.queue[r].fn.constructor==Function&&(this.queue[r].loaded++,this.queue[r].progress&&this.queue[r].progress(this.queue[r].loaded/this.queue[r].length),this.queue[r].fn()),this.queue.splice(r,1);else{var u=this.queue[r].items;console.log(JSON.stringify(this.queue));for(var n=u.length-1;n>=0;n--)console.log(u[n],i),u[n]==i&&(this.queue[r].loaded++,this.queue[r].progress&&this.queue[r].progress(this.queue[r].loaded/this.queue[r].length),u.splice(n,1))}Require.next(),Require.loaded++,Require.updateLoader()},Require.addItem=function(e,i,t,r){i=i||[],this.dictionary[e]||Require.length++,this.dictionary[e]={load:!1,items:i,length:i.length+1};for(var u=0;u<i.length;u++)this.dictionary[i[u]]||(Require.length++,this.dictionary[i[u]]={load:!1,items:[]});Require.queue.push({url:e,items:i,fn:t,progress:r,loaded:0,length:i.length+1})};
    function Track(t){var a=this;this.settings=t,this.audio=document.createElement("audio"),this.gain=t.gain||1,this.time=0,this.duration=0,this.progress=0,this.audio.ontimeupdate=function(){isNaN(this.duration)||(a.duration=this.duration),a.time=this.currentTime,a.dispatchEvent(Event.CHANGE)},this.audio.oncanplaythrough=function(){a.progress=1,a.dispatchEvent("loadProgress")},this.audio.onprogress=function(t){isNaN(this.duration)||(a.duration=this.duration),this.buffered.length>0&&(a.progress=this.buffered.end(this.buffered.length-1)/this.duration),a.dispatchEvent("loadProgress")},this.loop=t.loop>0&&t.loop,this.m4a=!(!this.audio.canPlayType||!this.audio.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/,"")),this.mp3=!(!this.audio.canPlayType||!this.audio.canPlayType("audio/mpeg;").replace(/no/,"")),this.ogg=!(!this.audio.canPlayType||!this.audio.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")),this.mp3&&t.mp3?this.audio.src=t.mp3:this.ogg&&t.ogg?this.audio.src=t.ogg:this.m4a&&t.m4a&&(this.audio.src=t.m4a),this.audio.src&&this.audio.load(),this.disable=!1,this.volume=(t.volume||.5)*this.gain,this.audio.volume=this.volume,this.status=Track.STOP,this.isReady=!1,addEvent(this.audio,"canplaythrough",function(t){a.ready(t)}),addEvent(this.audio,"ended",function(t){a.onEnd(t)}),ADD_EVENT_DISPATCHER(this)}Track.prototype.load=function(t){this.mp3&&t.mp3?this.audio.src=t.mp3:this.ogg&&t.ogg?this.audio.src=t.ogg:this.m4a&&t.m4a&&(this.audio.src=t.m4a),this.audio.load()},Track.prototype.cancel=function(){this.audio.src="",this.audio.load()},Track.prototype.getTimeString=function(){var t=Math.floor(this.time),a=t%60,i=Math.floor(t/60);return a=(a<10?"0":"")+a,(i=(i<10?"0":"")+i)+":"+a},Track.prototype.getTime=function(){return this.time},Track.PLAY="PLAY",Track.PAUSE="PAUSE",Track.STOP="STOP",Track.prototype.ready=function(t){this.isReady=!0,this.dispatchEvent("ready")},Track.prototype.onEnd=function(t){if(console.log(t),this.loop&&this.status==Track.PLAY){var a=this;this.timeout=setTimeout(function(){a.play()},this.loop)}else this.status=Track.STOP;this.dispatchEvent(Event.COMPLETE)},Track.prototype.getVolume=function(){return this.volume},Track.prototype.setVolume=function(t){this.volume=t,this.audio.volume=this.volume*this.gain},Track.prototype.play=function(){console.log("Track.Play()"),this.audio.play(),this.status=Track.PLAY,this.dispatchEvent(Event.STATE_CHANGE)},Track.prototype.pause=function(){this.audio.pause(),this.status=Track.PAUSE,this.dispatchEvent(Event.STATE_CHANGE)},Track.prototype.stop=function(){this.audio.pause(),this.isReady&&(this.audio.currentTime=0),clearTimeout(this.timeout),this.status=Track.STOP,this.dispatchEvent(Event.STATE_CHANGE)},Track.Buttons=[],Track.play=function(t,a,i){if(i.icon=i.getElementsByClassName("fa")[0],i.track||(i.track=new Track({mp3:t,autoPlay:!1,volume:a}),i.track.addEventListener(Event.COMPLETE,"onSoundComplete",i),i.track.addEventListener(Event.STATE_CHANGE,"onStatusChange",i),i.onSoundComplete=function(){for(var t=0;t<Track.Buttons.length;t++)Track.Buttons[t]==i&&Track.Buttons.splice(t,1);i.icon.className="PLAY"==i.track.status?"fa fa-pause":"fa fa-play"},i.onStatusChange=function(){i.icon.className="PLAY"==i.track.status?"fa fa-pause":"fa fa-play"}),"PLAY"==i.track.status)i.track.pause();else{for(i.track.play();Track.Buttons.length>0;)Track.Buttons.pop().track.stop();Track.Buttons.push(i)}};
    function easeOutElastic (t, b, c, d) {
        var s=0.70158;var p=0;var a=c;
        if (t===0) return b;  if ((t/=d)===1) return b+c;  if (!p) p=d*.3;
        if (a < Math.abs(c)) { a=c; s=p/4; }
        else s = p/(2*Math.PI) * Math.asin (c/a);
        return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
    }
    function easeOutBack (t, b, c, d, s) {
        var s = 1.70158;
        return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
    };
    
    
    function start(){
        var iframe = document.createElement('iframe');
        iframe.setAttribute('src', 'about:blank');
        iframe.style.position = 'fixed';
        iframe.style.top = 0;
        iframe.style.left = 0;
        iframe.style.right = 0;
        iframe.style.bottom = 0;
        
        iframe.style.display = "block";
        iframe.style.border =  0;
        iframe.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
        iframe.style.width = '100%';
        iframe.style.height= '100%';
        iframe.style.zIndex = 1000000;
        iframe.style.display = 'none';
        document.body.appendChild(iframe);
        
        var SVG = {};
        SVG.close = '<svg aria-hidden="true" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
        SVG.plus = '<svg aria-hidden="true" data-prefix="fas" data-icon="plus" class="svg-inline--fa fa-plus fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></svg>'
        var UI = {};
        var html = ''
        html += '<div var="button" style="width:48px;height:48px;border-radius:48px;top:50%;right:0; background-color:#0099D7;position: fixed;margin-top: -24px;margin-right: -24px;z-index:1000001;box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);cursor: pointer; color: #0099D7; transition:color 0.25s linear">' + SVG.close + '</div>';
        html += ''
        
        var SID = 30166;
        
        document.body.appendChild(Browser.DOM(html, UI));
        UI.button.children[0].style.position = 'absolute';
        UI.button.children[0].style.width = '20px';
        UI.button.children[0].style.top = '50%';
        UI.button.children[0].style.left = '50%';
        UI.button.children[0].style.transform = 'translate(-50%, -50%)';
        
        var timeLine = new TimeLine(900, 33);
        timeLine.direction = -1;
        timeLine.addEventListener(Event.CHANGE, 'onRender', timeLine);
        timeLine.onRender = function(){
            iframe.style.display = (this.position > 0 ? '' : 'none');
            iframe.style.opacity = (this.getTime(100, 400));
            UI.button.style.color = (this.position > 400 ? '#fff' : '#0099D7')
            TimeLine.applyMatrix(UI.button, {x: -48 * this.getTime(300, 200)});
            var children = document.body.children;
            function noBlur(element){
                if (element == UI.button || element == iframe){
                    return false;
                }
                return true;
            }
            for (var iChild = 0; iChild < children.length; iChild++) {
                var blur = (timeLine.position == 0 ? '' : 'blur(' + Math.min(Math.floor(timeLine.position / 100), 5) + 'px)')
                children[iChild].style.filter = (noBlur(children[iChild]) ? blur : '')
            }
        
            for (var iItem = 0; iItem < items.length; iItem++){
                var x = Math.cos((130 + 33.3 * (3 - iItem)) * Math.PI / 180) * 150 * this.getTime(300 + iItem * 50, 200, easeOutBack) + 40 * this.getTime(300 + iItem * 50, 200);
                var y = Math.sin((130 + 33.3 * (3 - iItem)) * Math.PI / 180) * 150 * this.getTime(300 + iItem * 50, 200, easeOutBack);
                TimeLine.applyMatrix(items[iItem].html, {x:x, y:y, opacity: this.getTime(300 + iItem * 50, 200)});
                TimeLine.applyMatrix(items[iItem].html.UI.label, {opacity: this.getTime(500 + iItem * 50, 200), x: 20 - 20 * this.getTime(500 + iItem * 50, 200, easeOutBack)});
            }
        }
        UI.button.onclick = function(){
            timeLine.direction = -(timeLine.direction);
            timeLine.play();
        }
        
        var body = iframe.contentWindow.document.body;
        var head = iframe.contentWindow.document.head;
        var font = document.createElement('link');
        font.setAttribute('href', "https://fonts.googleapis.com/css?family=Roboto");
        font.setAttribute('rel', 'stylesheet');
        head.appendChild(font);
        
        body.innerHTML = `
        <style type="text/css">
            html, body{
                font-family:'Roboto', sans-serif;
            }
            .game-icon, 
            .plus-game-icon{
                position:absolute;
                top: 50%;
                right: 48px;
            }
            .game-icon img{
                width: 48px;
                height: 48px;
                border-radius: 48px;
                overflow: hidden;
                position: absolute;
                top: -24px;
                right: -24px;
            }
            .game-icon span,
            .plus-game-icon span{
                position: absolute;
                line-height: 40px;
                font-size: 12px;
                color: #fff;
                margin-top: -20px;
                top: 0;
                right: 45px;
                white-space: nowrap;
            }
            .plus-game-icon b{
                width: 48px;
                height: 48px;
                border-radius: 48px;
                overflow: hidden;
                position: absolute;
                top: -24px;
                right: -24px;
                box-sizing:border-box;
                border: 2px solid #fff;
                background-color: rgba(0, 0, 0, 0.5);
                color: #fff;
            }
            .plus-game-icon svg{
                width: 20px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
        </style>`;
        var items = [];
        var json = new JSON_Loader();
        json.load('https://games.gamepix.com/games?sid=' + SID)
        json.addEventListener(Event.COMPLETE, 'onData', json);
        json.onData = function(){
            
            items.push(this.data.data[Math.floor(this.data.data.length * Math.random())])
            items.push(this.data.data[Math.floor(this.data.data.length * Math.random())])
            items.push(this.data.data[Math.floor(this.data.data.length * Math.random())])
            for (var iItem = 0; iItem < items.length; iItem++){
                var itemUI = {};
                var html = '';
                html += '<div class="game-icon">'
                html += ' <span var="label"></span>'
                html += ' <img var="img">';
                html += '</div>'
                var item = Browser.DOM(html, itemUI)
                itemUI.label.innerHTML = items[iItem].title;
                itemUI.img.src = items[iItem].thumbnailUrl100;
                items[iItem].html = item;
                item.UI = itemUI;
                body.appendChild(item);
            }
        
            var itemUI = {};
            var html = '';
            html += '<div class="plus-game-icon">'
            html += ' <span var="label">More Games</span>'
            html += ' <b>' + SVG.plus + '</b>';
            html += '</div>'
            var item = Browser.DOM(html, itemUI)
            items.push({html:item});
            item.UI = itemUI;
            body.appendChild(item);
        }
    }
    addEvent(window, 'load', start)
    
    /*
    
    
    
    console.log(UI.button)*/
})();
    